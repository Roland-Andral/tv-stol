<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>TV STOL</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  color: white;
  width: 100%;
  height: 100%;
  overflow: hidden;
  font-family: Arial, sans-serif;
}
#message {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 5vw;
  text-align: center;
  height: 100%;
}
iframe {
  width: 100%;
  height: 100%;
  border: none;
}
</style>
</head>

<body>
<div id="message">Chargementâ€¦</div>

<script>
const URL =
 "https://docs.google.com/spreadsheets/d/1RAIdAw_wSAK7kyFPCYjGqX5bCzS1e2n3lTRf2Tkrz5k/gviz/tq?tqx=out:json&sheet=Affichage";

let currentMode = "";
let currentValue = "";

function refresh() {
  fetch(URL)
    .then(r => r.text())
    .then(t => {
      const json = JSON.parse(t.substring(47).slice(0, -2));
      const rows = json.table.rows;

      const mode = rows[0].c[0]?.v || "MESSAGE";

      let value = "";
      if (mode === "MESSAGE") value = rows[0].c[1]?.v || "";
      if (mode === "YOUTUBE") value = rows[1].c[1]?.v || "";
      if (mode === "SLIDES")  value = rows[2].c[1]?.v || "";

      if (mode === currentMode && value === currentValue) return;
      currentMode = mode;
      currentValue = value;

      afficher(mode, value);
    });
}

function afficher(mode, value) {
  document.body.innerHTML = "";

  if (mode === "MESSAGE") {
    const div = document.createElement("div");
    div.id = "message";
    div.textContent = value;
    document.body.appendChild(div);
  } else {
    const iframe = document.createElement("iframe");
    iframe.src = value;
    document.body.appendChild(iframe);
  }
}

refresh();
setInterval(refresh, 2000);
</script>
</body>
</html>
